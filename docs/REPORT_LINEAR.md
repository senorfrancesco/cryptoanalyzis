# Отчёт о реализации линейного криптоанализа шифра GFN-16 (Вариант 5)

## 1. Введение
В дополнение к дифференциальному анализу был проведен **Линейный криптоанализ (Linear Cryptanalysis, LC)** шифра GFN-16 (Вариант 5).
Метод основан на поиске линейных аппроксимаций, связывающих биты открытого текста, шифротекста и ключа с вероятностью $P \neq 0.5$.

## 2. Методология атаки
Атака реализована по "Алгоритму 2" Мацуи (Matsui's Algorithm 2), который позволяет восстановить ключ последнего раунда, используя линейную характеристику для $(R-1)$ раундов.

### 2.1. Поиск линейной характеристики
Для 5 раундов шифра был выполнен поиск лучшей линейной аппроксимации вида:
$$ \alpha \cdot P \oplus \beta \cdot C_5 = 0 $$
где $\alpha$ — входная маска, $\beta$ — выходная маска, а операция "$\\cdot$" обозначает скалярное произведение битов (четность веса Хэмминга `popcount(mask & val) & 1`).

**Результаты поиска:**
Был произведен перебор масок с весом Хэмминга $w_H \le 3$ на выборке $N=100,000$ случайных текстов.
Найдена чрезвычайно сильная характеристика:
*   **Входная маска ($\\alpha$):** `0x0004` (бит 2 активен).
*   **Выходная маска ($\\beta$):** `0x2140` (биты 6, 8, 13 активны).
*   **Смещение (Bias, $\\epsilon$):** $\\epsilon \approx 0.12586$.
    *   Вероятность выполнения уравнения: $P \approx 0.5 + 0.125 = 0.625$.

Это означает, что уравнение $\\alpha \cdot P \oplus \\beta \cdot C_5 = 0$ выполняется в 62.5% случаев, что является очень сильным отклонением для 5 раундов.

### 2.2. Процедура атаки
Используется метод *Known-Plaintext Attack (KPA)*. Атакующий имеет набор пар $(P, C)$ для полных 6 раундов.

**Алгоритм:**
1.  **Набор данных:** Сгенерировано $N = 50,000$ пар $(P, C)$.
2.  **Гипотеза ключа:** Перебираются все возможные ключи последнего (6-го) раунда $k_g \in \{0 \dots 15\}$.
3.  **Частичное дешифрование:**
    Для каждого шифротекста $C$ и гипотезы $k_g$ вычисляется состояние $C_{prev}$ (выход 5-го раунда):
    $$ C_{prev} = F^{-1}(C, k_g) $$
4.  **Проверка уравнения:**
    Считается количество раз $T$, когда выполняется линейное соотношение:
    $$ (\alpha \cdot P) \oplus (\beta \cdot C_{prev}) = 0 $$
5.  **Оценка смещения:**
    Для каждого ключа вычисляется экспериментальное смещение:
    $$ Bias(k_g) = |T/N - 0.5| $$
    Ключ с максимальным смещением считается верным.

## 3. Результаты эксперимента

Атака была проведена на наборе $N=50,000$ текстов.

### Топ кандидатов:
| Ранг | Ключ (Hex) | Ключ (Dec) | Bias | Совпадений |
| :--- | :--- | :--- | :--- | :--- |
| **1** | **0xB** | **11** | **0.12426** | **31213** |
| 2 | 0xD | 13 | 0.02848 | 23576 |
| 3 | 0x3 | 3 | 0.02656 | 23672 |
| ... | ... | ... | ... | ... |

**Анализ:**
*   **Истинный ключ (0xB)** был однозначно идентифицирован.
*   **Отрыв:** Смещение правильного ключа ($0.124$) в **4.4 раза** превышает смещение ближайшего ложного кандидата ($0.028$).
*   **Отсутствие "призраков":** В отличие от дифференциальной атаки, где наблюдался ложный кандидат с таким же весом, линейная атака дала единственный четкий пик.

## 4. Выводы
1.  **Уязвимость:** Шифр GFN-16 (Вариант 5) крайне неустойчив к линейному криптоанализу. Смещение $2^{-3}$ для 5 раундов — это катастрофическая уязвимость.
2.  **Сравнение методов:** Для данной архитектуры линейный анализ показал себя **более эффективным**, чем дифференциальный. Он потребовал меньше специфических условий (работает на Known Plaintext, а не Chosen Plaintext) и дал более однозначный результат (нет ложных ключей-лидеров).
3.  **Причина слабости:** Вероятно, S-box имеет большие линейные смещения, а структура перестановок (сдвигов) плохо перемешивает биты, позволяя линейным следам сохраняться на протяжении 5 раундов.
