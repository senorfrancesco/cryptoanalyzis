# ПЛАН РЕФАКТОРИНГА: АНАЛИТИЧЕСКИЙ ДИФФЕРЕНЦИАЛЬНЫЙ КРИПТОАНАЛИЗ

## ЭТАП 1: МАТЕМАТИЧЕСКИЙ АНАЛИЗ S-БЛОКА (DDT)
Цель: Перейти от статистического угадывания к точному расчету вероятностей.

- [x] **Создание модуля ddt_generator:**
    - Реализовать функцию построения таблицы распределения разностей (DDT) для S-блока G.
    - Таблица 16x16, где ячейка [in][out] хранит количество случаев (0-16), когда разность "in" переходит в разность "out".
- [x] **Экспорт характеристик S-блока:**
    - Выделить переходы с максимальной вероятностью (например, 2 -> 12 с p=0.5).
    - Эти значения станут основой для построения цепочки (траектории).

## ЭТАП 2: ПОИСК ОПТИМАЛЬНОЙ ТРАЕКТОРИИ (TRAIL SEARCH)
Цель: Найти "золотой" дифференциал для 5 раундов с наивысшей теоретической вероятностью.

- [x] **Алгоритм поиска траектории (Trail Finder):**
    - Реализовать поиск в ширину (BFS) или алгоритм Витерби для графа состояний.
    - Узел графа: 16-битное состояние (4 ниббла разностей).
    - Ребро: переход в 1 раунд через функцию F и сдвиг.
- [x] **Расчет вероятности:**
    - Итоговая вероятность траектории — произведение вероятностей переходов S-блоков в каждом раунде: P_total = p1 * p2 * p3 * p4 * p5.
    - Игнорировать ключи при расчете (т.к. разность на XOR с ключом не меняется).
- [x] **Выбор цели:**
    - Зафиксировать входную разность (TARGET_dX) и выходную разность после 5 раундов (TARGET_dY) с максимальным P_total.

## ЭТАП 3: РЕФАКТОРИНГ ГЕНЕРАТОРА ДАННЫХ
Цель: Оптимизировать сбор данных под конкретную траекторию.

- [x] **Адаптация generator_of_data.cpp:**
    - Вместо перебора всех dX использовать только найденную TARGET_dX.
    - Генерировать пары (P, P ^ TARGET_dX).
    - Это позволит значительно уменьшить объем файла pairs_data.txt при сохранении эффективности атаки.

## ЭТАП 4: МОДЕРНИЗАЦИЯ АТАКИ (ATTACK ENGINE)
Цель: Использовать аналитическую мишень для восстановления ключа.

- [x] **Обновление attack_last_round.cpp:**
    - Установить TARGET_dY в качестве жесткого критерия для "отката" 6-го раунда.
    - Логика: если (Dec(C, k) ^ Dec(C', k)) == TARGET_dY, то k получает балл.
- [x] **Автоматизация:**
    - Связать вывод Trail Finder с входными параметрами атаки, чтобы исключить ручной ввод разностей.

## ЭТАП 5: ОБНОВЛЕНИЕ ДОКУМЕНТАЦИИ И ОТЧЕТОВ
- [ ] **Корректировка REPORT_DIFFERENTIAL.md:**
    - Описать теоретический вывод дифференциала через DDT вместо статистического.
    - Добавить таблицу переходов по раундам с указанием вероятностей в каждом узле.
- [ ] **Обновление LaTeX-файла:**
    - Включить формулу итоговой вероятности P_total и обоснование выбора характеристик через DDT.